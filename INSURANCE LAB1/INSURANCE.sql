DROP DATABASE IF EXISTS newdatabase;
CREATE DATABASE newdatabase;
USE newdatabase;
CREATE TABLE PERSONS (
  driver_id VARCHAR(20) PRIMARY KEY,
  driname VARCHAR(50),
  address VARCHAR(50)
);
INSERT INTO PERSONS (driver_id, driname, address) VALUES
('A01', 'TINA', 'PUNE'),
('A02', 'MINA', 'KATHMANDU'),
('A03', 'SINA', 'DELHI'),
('A04', 'NINA', 'BHAKTAPUR'),
('A05', 'GINA', 'BANGALORE');
CREATE TABLE CARS (
  reg_num VARCHAR(10) PRIMARY KEY,
  model VARCHAR(20),
  years INT
);
INSERT INTO CARS (reg_num, model, years) VALUES
('KA052250', 'Honda', 1967),
('KA031181', 'Lancer', 1999),
('KA095477', 'Audi', 2000),
('KA041702', 'Toyota', 1945);
CREATE TABLE ACCIDENTS (
  report_no INT PRIMARY KEY,
  accident_date DATE,
  location VARCHAR(50)
);
INSERT INTO ACCIDENTS (report_no, accident_date, location) VALUES
(345, '2005-03-29', 'MG Road'),
(395, '2010-09-09', 'Church Street'),
(445, '2008-01-11', 'Lokanthali'),
(945, '2011-02-12', 'Mysore'),
(667, '2001-03-10', 'Basavanagudi');
CREATE TABLE OWNS (
  driver_id VARCHAR(20),
  reg_num VARCHAR(10),
  PRIMARY KEY (driver_id, reg_num),
  FOREIGN KEY (driver_id) REFERENCES PERSONS(driver_id),
  FOREIGN KEY (reg_num) REFERENCES CARS(reg_num)
);
INSERT INTO OWNS (driver_id, reg_num) VALUES
('A01', 'KA052250'),
('A02', 'KA031181'),
('A03', 'KA095477'),
('A04', 'KA041702');
CREATE TABLE PARTICIPATE (
  driver_id VARCHAR(20),
  reg_num VARCHAR(10),
  report_no INT,
  damage_amount INT,
  PRIMARY KEY (reg_num, report_no),
  FOREIGN KEY (driver_id) REFERENCES PERSONS(driver_id),
  FOREIGN KEY (reg_num) REFERENCES CARS(reg_num),
  FOREIGN KEY (report_no) REFERENCES ACCIDENTS(report_no)
);
INSERT INTO PARTICIPATE (driver_id, reg_num, report_no, damage_amount) VALUES
('A01','KA052250',345,10000),
('A02','KA031181',395,50000),
('A03','KA095477',445,25000),
('A04','KA041702',945,3000),
('A05','KA041702',667,5000);
UPDATE PARTICIPATE
SET damage_amount = 25000
WHERE reg_num = 'KA031181' AND report_no = 395;
SELECT COUNT(DISTINCT a.driver_id) AS CNT
FROM PARTICIPATE a
JOIN ACCIDENTS b ON a.report_no = b.report_no
WHERE a.report_no = 395;
INSERT INTO ACCIDENTS (report_no, accident_date, location)
VALUES (16, '2008-03-08', 'Domlur');
SELECT * FROM ACCIDENTS;
SELECT * FROM PARTICIPATE ORDER BY DAMAGE_AMOUNT DESC;
SELECT AVG(DAMAGE_AMOUNT) FROM PARTICIPATE;
SELECT *
FROM PARTICIPATE
WHERE DAMAGE_AMOUNT < (
  SELECT AVG(DAMAGE_AMOUNT)
  FROM PARTICIPATE
);
DELETE FROM PARTICIPATE
WHERE DAMAGE_AMOUNT < (
  SELECT avg_val
  FROM (
    SELECT AVG(DAMAGE_AMOUNT) AS avg_val
    FROM PARTICIPATE
  ) AS temp
);
 
SELECT A.dname
FROM PERSONNN A, PARTICIPATE B
WHERE A.DRIVER_ID = B.DRIVER_ID
  AND B.DAMAGE_AMOUNT > (SELECT AVG(DAMAGE_AMOUNT) FROM PARTICIPATE);
  SELECT MAX(DAMAGE_AMOUNT) FROM PARTICIPATE;

SELECT *FROM ACCIDENT;




